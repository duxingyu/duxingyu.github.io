var Linkpre,sound={},chLevel=0,bookNum=1,bookSlideData=null,recorder=Recorder(),recorderIndex=0,handtipShow=!1,timers=new Array;timers.clear=function(){this.forEach(function(e){return clearTimeout(e)}),this.length=0};var queue=new createjs.LoadQueue(!0,"./src/1/ch1/");function preloadImgs(){for(var e=[],n=0;n<book.length;n++)e.push(n+1+"/bg.png"),e.push(n+1+"/texture.png");e.push("https://mytianh5.oss-cn-beijing.aliyuncs.com/readingClass/1/video/expand.mp4","https://mytianh5.oss-cn-beijing.aliyuncs.com/readingClass/1/video/book.mp4"),queue.on("complete",function(){console.log("complete")},this),queue.loadManifest(e)}preloadImgs();var video1=new MMD.VideoPlayer({videoElement:$("video")[0],src:"https://mytianh5.oss-cn-beijing.aliyuncs.com/readingClass/expandtitle.mp4",onStart:function(){video2.src="https://mytianh5.oss-cn-beijing.aliyuncs.com/readingClass/1/video/expand.mp4",video2.play(),video2.muted=!0,setTimeout(function(){video2.pause(),video2.muted=!1},0)},onEnd:function(){$("#video").show(),$("#expand video").hide(),video2.currentTimeAndPlay=0}}),video2=new MMD.VideoPlayer({videoElement:$("video")[1],src:"https://mytianh5.oss-cn-beijing.aliyuncs.com/readingClass/1/video/book.mp4",onStart:function(){},onEnd:function(){-1!=video2.src.indexOf("book")?jiesuan.appear(1):jiesuan.appear(2)}}),gameStyle=null,tweens=TWEEN,Tween=TWEEN.Tween,thingTweens={shake:null},scales=null,device="",animates={_add:function(n){animates[n]=function(){var e=window[n];e&&e.renderer.render(e.stage)}},_remove:function(e){var n=[];if(e)n=isArr(e)?e:[e];else for(var o in animates)-1==o.indexOf("_")&&n.push(o);n.map(function(e){return delete animates[e]})}},listIsClick=!1,swiper=null,swiperData=null,swiperStep=0,quesIndex=0;function animate(e){for(var n in requestAnimationFrame(animate),TWEEN.update(e),animates){var o=animates[n];o&&-1==n.indexOf("_")&&o()}}function clearAll(){timers.clear(),tweens.clear(),stopSound(),recorder.close(),sound.maimai.off("end"),video1.pause(),video2.pause()}function stopSound(e){for(var n in sound)0!==n.indexOf(e)&&sound[n].stop()}function addBookSounds(){var a={};bookSounds.forEach(function(e){return a[e]={}}),book.forEach(function(e,n){for(var o in e.sounds)if(isArr(e.sounds[o][0]))for(var s=e.sounds[o],i=0;i<s.length;i++)a[o]["p"+(n+1)+"_"+(i+1)]=[s[i][0],s[i][1]-s[i][0]];else{s=e.sounds[o];a[o]["p"+(n+1)]=[s[0],s[1]-s[0]]}});function e(e){sound[e]=new Howl({src:"./src/1/music/"+e+".mp3",sprite:a[e],onplayerror:function(){sound[e].once("unlock",function(){sound[e].play()})}})}for(var n in a)e(n)}function pangbaiPlay(s,i){var a=swiperData.pangbais,t=a[s].size[i],e={w:0},n=a[s].size[a[s].size.length-1].x;t.x0?e.w=t.x0:a[s].size[i-1]&&(e.w=a[s].size[i-1].x);var o=new Tween(e).to({w:t.x},t.tb-t.ta).onUpdate(function(){$(".slide"+bookNum+" .pangbaia.pangbai"+(s+1)).css({width:n-e.w+"px",left:e.w+a[s].pos.x+"px"}),$(".slide"+bookNum+" .pangbai"+(s+1)+"b").css("width",e.w+"px")}).onComplete(function(){var e=0,n=s,o=i;if(a[s].size[i+1])o=i+1,e=a[s].size[i+1].ta-t.tb;else{if(!a[s+1])return $(".arrow").show(),void(t.expand&&expandShow());o=0,e=a[n=s+1].size[0].ta-t.tb}if(t.expand)return $(".arrow").show(),void expandShow();proxyTimeout(function(){pangbaiPlay(n,o)},e)}).start();tweens.add(o)}function expandShow(){if(swiperStep++,$(".expandbtn").eq(bookNum-1).show(),!handtipShow&&1==bookNum){handtipShow=!0,$("#handtip").show();var e={x:15,y:72},n=new Tween(e).to({x:7,y:64},500).onUpdate(function(){$("#handtip").css({left:e.x+"%",top:e.y+"%"})}).onComplete(function(){setTimeout(function(){return $("#handtip").hide()},500)}).start();tweens.add(n)}}function enterLevel(){clearAll(),jiesuan.hide(),listIsClick=!1,scales="scale("+parseFloat($("#wrapper").css("width"))/1440+", "+parseFloat($("#wrapper").css("height"))/832+")",$("#home").hide(),$("#chs").show(),$(".ch").hide(),$(".ch"+chLevel).show();var e=sound.maimai;if(4!=chLevel&&(1==chLevel?sound.title.play():e.play("card"+chLevel),titles.appear()),1==chLevel){if($("#book .fengmian").show(),swiper)return void $("#book .swiper").hide();swiper=new Swiper({container:$("#book .swiper")[0],isVertical:!1,keepDefaultClasses:["expandbtn","laba","arrow"],data:bookSlideData}),swiperData=book[0],swiper.on("swipeChanged",function(){$(".arrow").hide(),bookSlidePlay(),0==swiper.getCurrentIndex()?$(".prev").addClass("disable"):$(".prev").removeClass("disable"),swiper.getCurrentIndex()==$(".slide").length-1?$(".next").addClass("disable"):$(".next").removeClass("disable")}),$(".slide .wrap").css({top:$("#wrapper").css("top"),left:$("#wrapper").css("left"),transform:scales}),$(".fengmian").css({top:$("#wrapper").css("top"),left:$("#wrapper").css("left"),transform:scales}),$("#book .swiper").hide()}else 2==chLevel?($("#ques .bg").show(),$("#ques .wrap").css("transform",scales),quesIndex=0,proxyTimeout(function(){quesAppend(),titles.hide(),$("#ques .bg").hide()},2e3)):3==chLevel?($("#record .bg").show(),$("#record .recordplaybtn").hide(),$("#record .wrap").css("transform",scales),recorder.open(),recorderIndex=0,proxyTimeout(function(){recordAsk(),titles.hide()},2e3)):(video1.currentTimeAndPause=0,$("#expand video").show(),video1.play())}function bookSlidePlay(){if(bookNum=swiper.getCurrentIndex()+1,swiperData=book[bookNum-1],swiperStep=0,!listIsClick){$(".slide"+bookNum+" .imgs").children().remove(),$(".slide"+bookNum+" .imgs").html(bookSlideData[bookNum-1].imgs),$(".slide"+bookNum+" .pangbaia").css({width:"",left:""}),$(".slide"+bookNum+" .pangbaib").css({width:""}),$(".slide"+bookNum+" .expandbtn").hide(),clearAll();var e=sound[swiperData.pangbaibu?"pangbaibu":"pangbai"];e.play(e._sprite["p"+bookNum]?"p"+bookNum:"p"+bookNum+"_1"),pangbaiPlay(0,0),swiperData.expand2&&swiperData.expand2()}}function recordAsk(){var e="scene"+(recorderIndex+1);$("#record .scene").removeClass("scene1 scene2"),$("#record .scene").addClass(e),$("#record .quescont").removeClass("scene1ques scene2ques"),$("#record .quescont").addClass(e+"ques"),sound.maimai.play("record"+(recorderIndex+1)),sound.maimai.once("end",function(){$("#record .recordbtn").show()}),$("#record .bg").hide()}function recorderPlay(e){var n=new FileReader;n.onload=function(e){var n=e.target.result;sound["recorder"+(recorderIndex+1)]=new Howl({src:n,onend:function(){console.log("end")},onload:function(){$("#record .recordplaybtn").show()}})},n.readAsDataURL(e)}function animThingScale(e){var n={scale:1},o=new Tween(n).to({scale:1.1},700).repeat(1/0).yoyo(!0).onUpdate(function(){return e.css("transform","scale("+n.scale+")")}).start();return tweens.add(o),o}function animSpeakBoxScale(e,n){var o={scale:n?1:0},s={scale:n?0:1};n||e.show();var i=new Tween(o).to(s,500).onUpdate(function(){return e.css("transform","scale("+o.scale+")")}).start();return tweens.add(i),i}function animThingShake(e){e.show();var n={rotate:3},o=new Tween(n).to({rotate:-3},500).repeat(1/0).yoyo(!0).onUpdate(function(){return e.css("transform","rotate("+n.rotate+"deg)")}).start();return tweens.add(o),thingTweens.shake=o}function ansBoxShake(e){e.addClass("no");var n={rotate:2},o=new Tween(n).to({rotate:-2},100).repeat(6).yoyo(!0).onUpdate(function(){return e.css("transform","rotate("+n.rotate+"deg)")}).onComplete(function(){o=new Tween(n).to({rotate:0},50).onUpdate(function(){return e.css("transform","rotate("+n.rotate+"deg)")}).onComplete(function(){return e.removeClass("no")}).start()}).start();tweens.add(o),thingTweens.shake=o}function thingSpeak(e,n){void 0===n&&(n={});var o=$(".sprite"+bookNum+"."+e),s=$(".sprite"+bookNum+"."+(n.hua?n.hua:e+"_hua")),i=sound[n.soundname?n.soundname:e],a=n.soundSprite?n.soundSprite:"p"+bookNum;function t(){animThingShake(o),s.length&&animSpeakBoxScale(s),"none"!=n.soundname&&(i.play(a),i.once("end",function(){thingTweens.shake.stop(),n.hide&&animSpeakBoxScale(s,!0),n.callback&&n.callback()}))}n.changeThing?(o=$(".sprite"+bookNum+"."+n.changeThing),imgsTras(e,n.changeThing),proxyTimeout(t,800)):t()}function imgsTras(e,n,o,s){void 0===o&&(o=800);var i={opacity:1},a=$(".slide"+bookNum+" ."+e),t=$(".slide"+bookNum+" ."+n);a.css("opacity",1),a.show(),t.css("opacity",0),t.show();var r=new Tween(i).to({opacity:0},o).onUpdate(function(){a.css("opacity",i.opacity),t.css("opacity",1-i.opacity)}).onComplete(function(){s&&s()}).start();return tweens.add(r),r}function addBookSlideData(){for(var e=[],n=0;n<book.length;n++){var o="",s="./src/"+bookNum+"/ch1/",i="",a="";for(var t in book[n].imgs){var r=book[n].imgs[t];i+='<div class="'+t+" sprite"+(n+1)+'" style="left: '+r.x+"px;top: "+r.y+"px;display: "+(r.hide?"none":"block")+';"></div>'}for(var d=0;d<book[n].pangbais.length;d++){var c=book[n].pangbais[d].pos;a+='\n        <div class="pangbai'+(d+1)+' pangbaia" style="top:'+c.y+"px;left:"+c.x+'px;">\n          <div class="pangbai'+(d+1)+"a sprite"+(n+1)+'"></div>\n        </div>\n        <div class="pangbai'+(d+1)+" pangbaib pangbai"+(d+1)+"b sprite"+(n+1)+'"  style="top:'+c.y+"px;left:"+c.x+'px;"></div>\n      '}o+='<div class="wrap slide'+(n+1)+'">\n      <img src="'+s+(n+1)+'/bg.png" class="bg">\n      <div class="laba"></div>\n      <div class="expandbtn"></div>\n      <div class="imgs">'+i+'</div>\n      <div class="pangbai">'+a+"</div>\n    </div>",e.push({content:o,imgs:i})}bookSlideData=e}function quesAppend(){$(".ansbox").removeClass("ok no"),$(".ansbox"+quesOks[quesIndex]).addClass("ok"),$(".ansbox .spriteq").remove(),$(".queswrap .spriteq").remove(),$(".ansbox").eq(0).append('<div class="spriteq ans'+(quesIndex+1)+'1"></div>'),$(".ansbox").eq(1).append('<div class="spriteq ans'+(quesIndex+1)+'2"></div>'),$(".queswrap").append('<div class="spriteq ques'+(quesIndex+1)+'"></div>'),$(".ui").hide(),quesIndex++,sound.maimai.off("end"),sound.maimai.play("ques"+quesIndex),sound.maimai.once("end",function(){proxyTimeout(function(){sound.maimai.play("ans"+quesIndex+"1"),scaleAnim($(".ansbox1"),{scale2:1.08,animTime:350})},700),sound.maimai.once("end",function(){proxyTimeout(function(){sound.maimai.play("ans"+quesIndex+"2"),scaleAnim($(".ansbox2"),{scale2:1.08,animTime:350})},700)})})}setWrapSize(),animate(),addBookSounds(),addBookSlideData(),$("#home").css("transform","scale("+parseFloat($("#wrapper").css("width"))/1440+", "+parseFloat($("#wrapper").css("height"))/832+")"),$(".chlist div").click(function(){var e=$(this);listIsClick||e.hasClass("filter")||(listIsClick=!0,sound.sfx_dianji.play(),chLevel=e.index()+1,scaleAnim(e,{callback:function(){$("#video").hide(),enterLevel()}}))}),$("#return").click(function(){listIsClick||(listIsClick=!0,clearAll(),scaleAnim($("#return"),{callback:function(){titles.hide(),$("#video").hide(),jiesuan.hide(),swiper&&swiper.swipeTo(0,{name:"slide",duration:0}),listIsClick=!1,$("#chs").isShow()?($("#chs").hide(),$("#chs .ch").hide(),$("#home").show()):wx.miniProgram.navigateBack()}}))}),$("#book").on("click",".expandbtn",function(){$(".expandbtn").eq(bookNum-1).hide(),swiperData["expand"+swiperStep]()}),$("#book").on("click",".laba",function(){clearAll(),bookSlidePlay()}),$("#book .arrow").click(function(){$(this).hasClass("disable")||($(this).hasClass("prev")?swiper.swipePrev():swiper.swipeNext())}),$("#book .bookmode").click(function(){swiper.transition={name:"slide",duration:500},isPortrait&&(swiper.sideLength=document.body.clientWidth),isPortrait&&$("#book .swiper").css({width:"100vh",height:"100vw"}),scaleAnim($(this),{callback:function(){titles.hide(),$("#book .swiper").show(),$("#book .fengmian").hide(),bookSlidePlay()}})}),$("#book .videomode").click(function(){video2.currentTime=0,video2.src="https://mytianh5.oss-cn-beijing.aliyuncs.com/readingClass/1/video/book.mp4",video2.muted=!0,video2.play(),setTimeout(function(){video2.pause(),video2.muted=!1},0),scaleAnim($(this),{callback:function(){titles.hide(),$("#video").show(),$("#book .fengmian").hide(),video2.play()}})}),$("#ques .ansbox").click(function(){$(this).children(".ui").isShow()||(stopSound(),$(this).hasClass("ok")?(scaleAnim($(this)),sound.yes.play(),sound.sfx_zhengque.play(),$(this).children(".ui").removeClass("uicuo").addClass("uidui"),proxyTimeout(function(){quesOks[quesIndex]?quesAppend():jiesuan.appear(2)},1e3)):($(this).children(".ui").removeClass("uidui").addClass("uicuo"),ansBoxShake($(this)),sound.no.play(),sound.sfx_cuowu.play()),$(this).children(".ui").show())}),$("#record .recordbtn").on("touchstart",function(){$(this).addClass("filter"),recorder.start()}),$("#record .recordbtn").on("touchend",function(){$(this).removeClass("filter"),recorder.stop(function(e,n){recorder.close(),$("#record .recordbtn").hide(),recorderPlay(e)},function(){$("#record .recordbtn").hide(),proxyTimeout(function(){$("#record .recordplaybtn").show()},1e3)})}),$("#record .recordplaybtn").click(function(){var e=sound["recorder"+(recorderIndex+1)];scaleAnim($(this),{callback:function(){e?(e.play(),e.once("end",function(){$("#record .recordplaybtn").hide(),2==++recorderIndex?jiesuan.appear(2):recordAsk()})):proxyTimeout(function(){$("#record .recordplaybtn").hide(),2==++recorderIndex?jiesuan.appear(2):recordAsk()},2e3)}})}),addSounds(["sfx_dianji","sfx_btn_in","svo_win","sfx_win","sfx_star_in","sfx_zhengque","sfx_cuowu","yes","no","sfx_sahua"],"common/music/"),window.onload=function(){document.addEventListener("touchstart",function(e){1<e.touches.length&&e.preventDefault()});var o=0;document.addEventListener("touchend",function(e){var n=(new Date).getTime();n-o<=300&&e.preventDefault(),o=n},!1),document.addEventListener("gesturestart",function(e){e.preventDefault()})},document.body.addEventListener("touchmove",function(e){return e.preventDefault()},{passive:!1}),function(){var e={card1:[2300,3564],card2:[4650,6e3],card3:[6800,8333],card4:[9200,10538],ques1:[19354,21988],ans11:[22505,23469],ans12:[24e3,25e3],ques2:[26e3,29829],ans21:[30569,31636],ans22:[32067,33252],ques3:[35e3,39200],ans31:[39937,40482],ans32:[41e3,42e3],ques4:[42800,44800],ans41:[45490,46555],ans42:[47137,48955],ques5:[50130,53246],ans51:[54200,55e3],ans52:[56875,57783],record1:[59273,66335],record2:[67643,74855]},n={};for(var o in e)n[o]=[e[o][0],e[o][1]-e[o][0]];sound.maimai=new Howl({src:"./src/1/music/maimai.mp3",sprite:n,onplayerror:function(){sound.maimai.once("unlock",function(){})}})}();var titles=new Game;titles.resource={card1:{type:"spine",path:"./src/1/",data:{x:720,y:415,visible:!1,mix:.3}},card2:{type:"spine",data:{x:720,y:420,visible:!1,mix:.3}},card3:{type:"spine",data:{x:720,y:410,visible:!1,mix:.3}}},titles.load=function(){this.load=null,titles.loadResource(titles.resource,titles.stage,function(){jiesuan.load()}),$("#titles").append(titles.renderer.view)},titles.appear=function(){$("#titles").show(),$("#titles").css("height",1==chLevel?"60%":"100%"),animates._add("titles");var e=titles.$("card"+chLevel);e.visible=!0,e.state.setAnimation(0,"idle",!1),e.state.addAnimation(0,"idle2",!0,0)},titles.hide=function(){$("#titles").hide(),titles.$("card"+chLevel)&&(titles.$("card"+chLevel).visible=!1),animates._remove("titles")},titles.load();
//# sourceMappingURL=main.js.map
